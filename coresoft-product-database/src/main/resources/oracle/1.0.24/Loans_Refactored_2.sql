--CREATING LOAN TABLE
create table Loan as
select ACCOUNT_NO,CREATION_DATE,BUSINESS_DATE,ACCOUNT_TYPE_ID,LAST_PROCESSED_DATE, LA.ACCOUNT_ID,CHARGE_OFF_AMOUNT,DATE_PREVIOUS_ACTIVITY,
CLOSED_DATE,LAST_STATEMENT_DATE,PRE_STATEMENT_DATE,LAST_STATEMENT_BAL,PRE_STATEMENT_BAL,PAY_OUT_CODE,LA.CONTRACT_ID,
GENERAL_LEDGER_ENTRIES_ID,ACCOUNT_CREDIT_REPORT_ID,PRINCIPAL_PAID_TO_DATE,UNAPPLIED_FUNDS,
FUTURE_PAYMENT_COUNT,LOAN_STATUS,PRINCIPLE_BALANCE,PARTIAL_PAYMENT,PAST_PRINCIPLE_DUE,STMT_CYCLE_CODE,
INTEREST_PAST_DUE,ACCRUED_INTEREST,INTEREST_PAID_TO_DATE,INTEREST_PAID_YTD,INTEREST_PAID_LTD,
OTHER_FEES_DUE,LATE_FEES_DUE,LATE_FEES_PAID_LTD,AMT_LC_WAIVED,LATE_FEES_PAID_YTD,LATE_CHARGE_ASSESSED_LIFE,
NEXT_PAYMENT_DUE_DATE,SCHEDULED_PAYMENT_DUE_DATE,LAST_PAYMENT_DATE,LAST_TRANSACTION_DATE,DATE_LAST_ACTIVITY,
PER_DIEM,PAYMENTS_MADE,NO_RETURNED_CHECKS,ACCRUED_INTEREST_NET,INITIAL_FUND_EFFECTIVE_DATE,
PAST_DUE_FLAG,LAST_CURT_AMOUNT,LAST_CURT_DATE,AMORTIZED_BALANCE,accumulated_interest,NO_OF_DAYS_PAST_DUE,
NEXT_DUE_DATE_BEFORE_POST,LAST_PAYMENT_AMOUNT,LAST_TRANSACTION_AMOUNT,DAY_LATECHARGE_AMOUNT,EXTENSION_ID,
PAST_DUE_DATE,IRS_AMOUNT,CURRENT_AGGREGATE_BAL,CURRENT_AVERAGE_BAL,CURRENT_LOW_BORROWING,CURRENT_HIGH_BORROWING,
PREVIOUS_AGGREGATE_BAL,PREVIOUS_AVERAGE_BAL,PREVIOUS_LOW_BORROWING,PREVIOUS_HIGH_BORROWING,INTEREST_PAID_MTD,NO_OF_DAYS_PASTDUE_BEFOREPOST 
from  LOAN_ACCOUNT LA,ACCOUNT ACCT WHERE LA.ACCOUNT_ID=ACCT.ACCOUNT_ID;


ALTER TABLE LOAN ADD CONSTRAINT L_ACCT_ID_UK UNIQUE(ACCOUNT_ID);

ALTER TABLE LOAN ADD ( CONSTRAINT L_ACCID_FK FOREIGN KEY(ACCOUNT_ID) REFERENCES ACCOUNT(ACCOUNT_ID));


ALTER TABLE LOAN_ACCOUNT SET UNUSED (CHARGE_OFF_AMOUNT,
DATE_PREVIOUS_ACTIVITY,
CLOSED_DATE,
LAST_STATEMENT_DATE,
PRE_STATEMENT_DATE,
LAST_STATEMENT_BAL,
PRE_STATEMENT_BAL,
PAY_OUT_CODE,
GENERAL_LEDGER_ENTRIES_ID,
ACCOUNT_CREDIT_REPORT_ID,
PRINCIPAL_PAID_TO_DATE,
UNAPPLIED_FUNDS,
FUTURE_PAYMENT_COUNT,
LOAN_STATUS,
PRINCIPLE_BALANCE,
PARTIAL_PAYMENT,
PAST_PRINCIPLE_DUE,
STMT_CYCLE_CODE,
INTEREST_PAST_DUE,
ACCRUED_INTEREST,
INTEREST_PAID_TO_DATE,
INTEREST_PAID_YTD,
INTEREST_PAID_LTD,
OTHER_FEES_DUE,
LATE_FEES_DUE,
LATE_FEES_PAID_LTD,
AMT_LC_WAIVED,
LATE_FEES_PAID_YTD,
LATE_CHARGE_ASSESSED_LIFE,
NEXT_PAYMENT_DUE_DATE,
SCHEDULED_PAYMENT_DUE_DATE,
LAST_PAYMENT_DATE,
LAST_TRANSACTION_DATE,
DATE_LAST_ACTIVITY,
PER_DIEM,
PAYMENTS_MADE,
NO_RETURNED_CHECKS,
ACCRUED_INTEREST_NET,
INITIAL_FUND_EFFECTIVE_DATE,
PAST_DUE_FLAG,
LAST_CURT_AMOUNT,
LAST_CURT_DATE,
AMORTIZED_BALANCE,
accumulated_interest,
NO_OF_DAYS_PAST_DUE,
NEXT_DUE_DATE_BEFORE_POST,
LAST_PAYMENT_AMOUNT,
LAST_TRANSACTION_AMOUNT,
DAY_LATECHARGE_AMOUNT,
EXTENSION_ID,
PAST_DUE_DATE,
IRS_AMOUNT,
CURRENT_AGGREGATE_BAL,
CURRENT_AVERAGE_BAL,
CURRENT_LOW_BORROWING,
CURRENT_HIGH_BORROWING,
PREVIOUS_AGGREGATE_BAL,
PREVIOUS_AVERAGE_BAL,
PREVIOUS_LOW_BORROWING,
PREVIOUS_HIGH_BORROWING,
INTEREST_PAID_MTD,
NO_OF_DAYS_PASTDUE_BEFOREPOST);

ALTER TABLE LOAN_ACCOUNT DROP UNUSED COLUMNS;

Alter table LOAN_ACCOUNT_EVENT add (INSTITUTION_ID varchar2(30));

update LOAN_ACCOUNT_EVENT lae set INSTITUTION_ID = (select INSTITUTION_ID  FRom Account a
where a.ACCOUNT_ID=lae.account_ID);
